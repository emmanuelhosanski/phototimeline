(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}})();const Z=[{id:"IMG_20170905_190424~2-15",src:"/photos/IMG_20170905_190424~2.jpg",date:"2017-09-05T17:04:25.000Z",label:"IMG_20170905_190424~2"},{id:"funchal-3",src:"/photos/funchal.jpg",date:"2018-09-11T08:49:08.000Z",label:"funchal"},{id:"IMG_20181103_152841-16",src:"/photos/IMG_20181103_152841.jpg",date:"2018-11-03T14:28:42.000Z",label:"IMG_20181103_152841"},{id:"IMG_20190104_100057-17",src:"/photos/IMG_20190104_100057.jpg",date:"2019-01-04T09:00:58.000Z",label:"IMG_20190104_100057"},{id:"IMG_20190104_122642-18",src:"/photos/IMG_20190104_122642.jpg",date:"2019-01-04T11:26:43.000Z",label:"IMG_20190104_122642"},{id:"IMG_20190316_123532-19",src:"/photos/IMG_20190316_123532.jpg",date:"2019-03-16T11:35:32.000Z",label:"IMG_20190316_123532"},{id:"20190608_Wedding_393-1",src:"/photos/20190608_Wedding_393.jpg",date:"2019-06-08T19:18:47.000Z",label:"20190608_Wedding_393"},{id:"IMG_20190831_153007-20",src:"/photos/IMG_20190831_153007.jpg",date:"2019-08-31T13:30:08.000Z",label:"IMG_20190831_153007"},{id:"IMG_20191006_120219-21",src:"/photos/IMG_20191006_120219.jpg",date:"2019-10-06T10:02:20.000Z",label:"IMG_20191006_120219"},{id:"IMG_20191229_111522-22",src:"/photos/IMG_20191229_111522.jpg",date:"2019-12-29T10:15:23.000Z",label:"IMG_20191229_111522"},{id:"20191230_Andalucia_450-2",src:"/photos/20191230_Andalucia_450.jpg",date:"2019-12-30T13:10:59.000Z",label:"20191230_Andalucia_450"},{id:"IMG_20200103_114742-23",src:"/photos/IMG_20200103_114742.jpg",date:"2020-01-03T10:47:43.000Z",label:"IMG_20200103_114742"},{id:"IMG_20200118_121634-24",src:"/photos/IMG_20200118_121634.jpg",date:"2020-01-18T11:16:35.000Z",label:"IMG_20200118_121634"},{id:"IMG_20200313_110953-25",src:"/photos/IMG_20200313_110953.jpg",date:"2020-03-13T10:09:54.000Z",label:"IMG_20200313_110953"},{id:"IMG_20200811_134133-26",src:"/photos/IMG_20200811_134133.jpg",date:"2020-08-11T11:41:35.000Z",label:"IMG_20200811_134133"},{id:"IMG_20201005_114914-27",src:"/photos/IMG_20201005_114914.jpg",date:"2020-10-05T09:49:15.000Z",label:"IMG_20201005_114914"},{id:"IMG_0167-4",src:"/photos/IMG_0167.HEIC",date:"2020-12-04T20:37:33.000Z",label:"IMG_0167"},{id:"IMG_1108-7",src:"/photos/IMG_1108.HEIC",date:"2021-05-12T15:44:39.000Z",label:"IMG_1108"},{id:"IMG_1394-9",src:"/photos/IMG_1394.HEIC",date:"2021-06-26T08:48:22.000Z",label:"IMG_1394"},{id:"IMG_1716-11",src:"/photos/IMG_1716.HEIC",date:"2021-07-25T17:12:56.000Z",label:"IMG_1716"},{id:"IMG_1847-12",src:"/photos/IMG_1847.HEIC",date:"2021-08-10T09:36:41.000Z",label:"IMG_1847"},{id:"IMG_1863 2-13",src:"/photos/IMG_1863 2.jpeg",date:"2021-08-11T09:26:28.000Z",label:"IMG_1863 2"},{id:"IMG_1863-14",src:"/photos/IMG_1863.jpeg",date:"2021-08-11T09:26:28.000Z",label:"IMG_1863"},{id:"IMG_2235-28",src:"/photos/IMG_2235.HEIC",date:"2021-10-30T09:52:47.000Z",label:"IMG_2235"},{id:"IMG_2257 2-29",src:"/photos/IMG_2257 2.jpeg",date:"2021-10-31T14:23:53.000Z",label:"IMG_2257 2"},{id:"IMG_2257-30",src:"/photos/IMG_2257.jpeg",date:"2021-10-31T14:23:53.000Z",label:"IMG_2257"},{id:"IMG_2573-32",src:"/photos/IMG_2573.HEIC",date:"2021-12-27T15:12:30.000Z",label:"IMG_2573"},{id:"IMG_2606-33",src:"/photos/IMG_2606.jpg",date:"2021-12-29T16:47:16.000Z",label:"IMG_2606"},{id:"IMG_2636-34",src:"/photos/IMG_2636.jpeg",date:"2021-12-31T11:08:20.000Z",label:"IMG_2636"},{id:"IMG_3252-35",src:"/photos/IMG_3252.HEIC",date:"2022-03-26T13:17:11.000Z",label:"IMG_3252"},{id:"IMG_3801-36",src:"/photos/IMG_3801.jpg",date:"2022-05-24T13:28:53.000Z",label:"IMG_3801"},{id:"IMG_4384-37",src:"/photos/IMG_4384.HEIC",date:"2022-08-03T09:17:46.000Z",label:"IMG_4384"},{id:"IMG_4492-38",src:"/photos/IMG_4492.HEIC",date:"2022-08-04T10:21:03.000Z",label:"IMG_4492"},{id:"IMG_4564-39",src:"/photos/IMG_4564.jpeg",date:"2022-08-05T07:54:11.000Z",label:"IMG_4564"},{id:"IMG_5766-40",src:"/photos/IMG_5766.jpeg",date:"2022-11-11T14:25:42.000Z",label:"IMG_5766"},{id:"IMG_5783-41",src:"/photos/IMG_5783.HEIC",date:"2022-11-12T15:05:04.000Z",label:"IMG_5783"},{id:"IMG_6439-42",src:"/photos/IMG_6439.jpeg",date:"2023-04-09T11:33:06.000Z",label:"IMG_6439"},{id:"IMG_6580-43",src:"/photos/IMG_6580.HEIC",date:"2023-05-07T07:35:26.000Z",label:"IMG_6580"},{id:"IMG_6703-44",src:"/photos/IMG_6703.jpeg",date:"2023-05-16T09:50:04.000Z",label:"IMG_6703"},{id:"IMG_0796-6",src:"/photos/IMG_0796.HEIC",date:"2023-08-02T20:14:23.000Z",label:"IMG_0796"},{id:"IMG_7527-45",src:"/photos/IMG_7527.jpg",date:"2023-10-27T11:01:01.000Z",label:"IMG_7527"},{id:"IMG_1390-8",src:"/photos/IMG_1390.jpeg",date:"2023-10-29T14:01:29.000Z",label:"IMG_1390"},{id:"IMG_8016-46",src:"/photos/IMG_8016.jpg",date:"2023-12-30T16:31:29.000Z",label:"IMG_8016"},{id:"IMG_8463-47",src:"/photos/IMG_8463.HEIC",date:"2024-03-17T13:25:43.000Z",label:"IMG_8463"},{id:"IMG_2370-31",src:"/photos/IMG_2370.jpeg",date:"2024-03-20T13:46:26.000Z",label:"IMG_2370"},{id:"IMG_9182-48",src:"/photos/IMG_9182.jpeg",date:"2024-08-13T16:39:30.000Z",label:"IMG_9182"},{id:"IMG_9382-49",src:"/photos/IMG_9382.jpg",date:"2024-09-11T12:05:07.000Z",label:"IMG_9382"},{id:"IMG_9410-50",src:"/photos/IMG_9410.HEIC",date:"2024-09-12T15:38:45.000Z",label:"IMG_9410"},{id:"IMG_9524-51",src:"/photos/IMG_9524.HEIC",date:"2024-10-12T10:39:53.000Z",label:"IMG_9524"},{id:"IMG_9887-52",src:"/photos/IMG_9887.jpg",date:"2025-01-01T15:56:31.000Z",label:"IMG_9887"},{id:"IMG_0682-5",src:"/photos/IMG_0682.HEIC",date:"2025-05-22T19:00:41.000Z",label:"IMG_0682"},{id:"IMG_1619-10",src:"/photos/IMG_1619.HEIC",date:"2025-06-28T06:54:22.000Z",label:"IMG_1619"}],D=[{id:"demo-1",src:"/earth.jpg",date:"2022-02-14T10:00:00.000Z",label:"Souvenir 1"},{id:"demo-2",src:"/earth.jpg",date:"2023-02-14T10:00:00.000Z",label:"Souvenir 2"},{id:"demo-3",src:"/earth.jpg",date:"2024-02-14T10:00:00.000Z",label:"Souvenir 3"},{id:"demo-4",src:"/earth.jpg",date:"2024-08-14T10:00:00.000Z",label:"Souvenir 4"}],$="timeline-love-high-score-v1",O=2,k="Nounours & Nounours",l=document.querySelector("#app");if(!l)throw new Error("App root introuvable");const a={active:!1,pointerId:null,ghost:null,activeZone:null},q=t=>{const s=new Date(t.date);return Number.isNaN(s.getTime())?null:{id:t.id,src:t.src,date:s,label:t.label??"Souvenir"}},x=Z.length>=3?Z:[...D],g=x.map(q).filter(t=>t!==null).sort((t,s)=>t.date.getTime()-s.date.getTime()),A=()=>g.find(t=>t.src.toLowerCase().includes("img_1390.jpeg"))??g[0],C=t=>t.toLocaleDateString("fr-FR",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),R=t=>t.toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}),F=t=>t.toLocaleDateString("fr-FR",{year:"numeric"}),Y=()=>{const t=localStorage.getItem($),s=t?Number(t):0;return Number.isFinite(s)&&s>=0?s:0},V=t=>{localStorage.setItem($,String(t))},U=t=>{if(t.length<O)return{seed:[],remaining:[]};const s=Math.floor(Math.random()*t.length);let o=Math.floor(Math.random()*t.length);for(;o===s;)o=Math.floor(Math.random()*t.length);const n=Math.min(s,o),r=Math.max(s,o),i=[t[n],t[r]].sort((d,h)=>d.date.getTime()-h.date.getTime()),c=t.filter((d,h)=>h!==n&&h!==r);return{seed:i,remaining:c}},X=t=>{const s=[...t];for(let o=s.length-1;o>0;o-=1){const n=Math.floor(Math.random()*(o+1));[s[o],s[n]]=[s[n],s[o]]}return s},W=()=>{const{seed:t,remaining:s}=U(g),o=X(s);return{timeline:t,upcoming:o.slice(1),current:o[0]??null,score:0,gameOver:!1,gameOverTitle:"",gameOverMessage:"",gameOverDateLabel:""}},m=()=>({...W(),highScore:Y(),started:!1,hintPhotoId:null,jokers:{pass:!0,rewind:!0,hint:!0},viewerPhotoId:null});let e=m();const E=["‚ù§Ô∏è‚Äçüî•","‚ù§Ô∏è","üòò","ü•∞","üß∏","üíò","üíï","üíû"],z=()=>{const t=document.createElement("div");t.className="emoji-burst-layer";for(let s=0;s<20;s+=1){const o=document.createElement("span");o.className="emoji-burst",o.textContent=E[Math.floor(Math.random()*E.length)];const n=30+Math.random()*40,r=-90+Math.random()*180,i=Math.random()*160,c=900+Math.random()*650,d=.8+Math.random()*1.1;o.style.left=`${n}%`,o.style.setProperty("--drift",`${r}px`),o.style.animationDelay=`${i}ms`,o.style.animationDuration=`${c}ms`,o.style.transform=`translate(-50%, 0) scale(${d})`,t.appendChild(o)}document.body.appendChild(t),setTimeout(()=>t.remove(),2100)},K=(t,s,o)=>{const n=t[o-1]??null,r=t[o]??null,i=!n||n.date.getTime()<=s.date.getTime(),c=!r||s.date.getTime()<=r.date.getTime();return i&&c},Q=()=>{e.score>e.highScore&&(e.highScore=e.score,V(e.highScore))},P=(t,s,o="")=>{e.gameOver=!0,e.gameOverTitle=t,e.gameOverMessage=s,e.gameOverDateLabel=o,Q()},B=()=>{const t=e.upcoming[0]??null;e.current=t,e.upcoming=e.upcoming.slice(1),e.hintPhotoId=null,e.current||P("Parfait !","Toutes les photos sont placees.","")},H=t=>{if(!e.started||e.gameOver||!e.current)return;const s=e.current;if(!K(e.timeline,s,t)){P("Oups !","Ce n'etait pas tout a fait le bon moment pour ce souvenir...",C(s.date)),p();return}e.timeline=[...e.timeline.slice(0,t),s,...e.timeline.slice(t)],e.score+=1,z(),B(),p()},J=()=>{!e.started||e.gameOver||!e.current||!e.jokers.pass||(e.jokers.pass=!1,e.upcoming=[...e.upcoming,e.current],B(),p())},ee=()=>{!e.started||e.gameOver||!e.current||!e.jokers.hint||(e.jokers.hint=!1,e.hintPhotoId=e.current.id,p())},y=()=>{!e.gameOver||!e.jokers.rewind||(e.jokers.rewind=!1,e.gameOver=!1,e.gameOverTitle="",e.gameOverMessage="",e.gameOverDateLabel="",p())},te=()=>{const t=e.highScore;e={...m(),highScore:t,started:!1},p()},se=async()=>{const t=`Score Timeline de ${k}: ${e.score} (record ${e.highScore})`;try{if(navigator.share){await navigator.share({text:t});return}await navigator.clipboard.writeText(t)}catch{}},oe=t=>{e.viewerPhotoId=t,p()},S=()=>{e.viewerPhotoId=null,p()},re=()=>{e.started=!0,p()},ne=()=>{const t=e.highScore;e={...m(),highScore:t,started:!0},p()},N=()=>{a.activeZone&&(a.activeZone.classList.remove("is-drop-target"),a.activeZone=null)},_=()=>{N(),a.ghost&&a.ghost.remove(),document.body.classList.remove("is-dragging-photo"),a.active=!1,a.pointerId=null,a.ghost=null},L=(t,s)=>{const o=document.elementFromPoint(t,s),n=(o==null?void 0:o.closest(".insert-plus:not([disabled])"))??null;a.activeZone!==n&&(N(),n&&(n.classList.add("is-drop-target"),a.activeZone=n))},ae=t=>{if(!e.started||e.gameOver||!e.current)return;t.preventDefault(),a.active=!0,a.pointerId=t.pointerId,document.body.classList.add("is-dragging-photo");const s=document.createElement("div");s.className="drag-ghost",s.innerHTML=`<img src="${e.current.src}" alt="Apercu" />`,document.body.appendChild(s),a.ghost=s;const o=(c,d)=>{a.ghost&&(a.ghost.style.left=`${c}px`,a.ghost.style.top=`${d}px`)};o(t.clientX,t.clientY),L(t.clientX,t.clientY);const n=c=>{!a.active||c.pointerId!==a.pointerId||(o(c.clientX,c.clientY),L(c.clientX,c.clientY))},r=c=>{if(!a.active||c.pointerId!==a.pointerId)return;const d=a.activeZone?Number(a.activeZone.dataset.insertIndex):NaN;_(),window.removeEventListener("pointermove",n),window.removeEventListener("pointerup",r),window.removeEventListener("pointercancel",i),Number.isFinite(d)&&H(d)},i=c=>{c.pointerId===a.pointerId&&(_(),window.removeEventListener("pointermove",n),window.removeEventListener("pointerup",r),window.removeEventListener("pointercancel",i))};window.addEventListener("pointermove",n),window.addEventListener("pointerup",r),window.addEventListener("pointercancel",i)},ie=()=>{const t=[];for(let s=0;s<=e.timeline.length;s+=1){t.push(`
      <button
        class="insert-plus"
        aria-label="Inserer ici"
        data-insert-index="${s}"
        ${e.gameOver||!e.current||!e.started?"disabled":""}
      >
        <span>+</span>
      </button>
    `);const o=e.timeline[s];o&&t.push(`
        <article class="timeline-item">
          <button class="timeline-photo-btn" data-photo-id="${o.id}" aria-label="Voir la photo en grand">
            <img src="${o.src}" alt="Souvenir place" loading="lazy" />
          </button>
          <div class="timeline-date">
            <p>${R(o.date)}</p>
            <strong>${F(o.date)}</strong>
          </div>
        </article>
      `)}return t.join("")},ce=()=>{const t=A();l.innerHTML=`
    <main class="intro-shell">
      <section class="intro-card">
        <h1>Timeline de<br />${k}</h1>
        <div class="intro-divider"></div>
        <div class="intro-visual-wrap">
          <div class="intro-orbit orbit-heart"><div class="intro-float">üíõ</div></div>
          <div class="intro-orbit orbit-star"><div class="intro-float">‚ú®</div></div>
          <div class="intro-visual">
            <img src="${t.src}" alt="Nounours" loading="eager" />
          </div>
        </div>
        <p class="intro-subtitle">REVIVEZ VOS PLUS BEAUX MOMENTS</p>
        <button id="startBtn" class="start-btn">Jouer</button>
      </section>
    </main>
  `;const s=l.querySelector("#startBtn");s&&s.addEventListener("click",re)},le=()=>{const t=e.current&&e.hintPhotoId===e.current.id?e.current.date.getFullYear():null,s=e.current?`
      <article class="current-card ${e.gameOver?"is-paused":""}">
        <img id="dragImage" src="${e.current.src}" alt="Photo a placer" loading="eager" draggable="false" />
        ${t?`<p class="hint-year">Indice: ${t}</p>`:""}
      </article>
    `:`
      <article class="current-card is-finished">
        <div class="current-meta solo">
          <p class="current-label">Partie terminee</p>
        </div>
      </article>
    `,o=e.gameOver?`
      <section class="game-over-modal">
        <div class="game-over-card">
          <div class="gameover-icon">üòµ</div>
          <p class="panel-title">${e.gameOverTitle}</p>
          <p class="panel-message">${e.gameOverMessage}</p>
          ${e.gameOverDateLabel?`<div class="gameover-date"><span>C'ETAIT LE</span><strong>${e.gameOverDateLabel}</strong></div>`:""}
          <div class="gameover-stats">
            <div class="stat-box"><span>SCORE</span><strong>${e.score}</strong></div>
            <div class="stat-divider"></div>
            <div class="stat-box"><span>MEILLEUR</span><strong>${e.highScore}</strong></div>
          </div>
          <div class="panel-actions">
            ${e.jokers.rewind?'<button id="rewindBtn" class="primary-btn">‚è™ Rewind</button>':""}
            <button id="replayBtn" class="secondary-btn">Rejouer</button>
            <button id="quitBtn" class="ghost-btn">Quitter</button>
            <button id="shareBtn" class="link-btn">Partager mon score</button>
          </div>
        </div>
      </section>
    `:"",n=e.viewerPhotoId?e.timeline.find(u=>u.id===e.viewerPhotoId)??null:null,r=n?`
      <section class="viewer-modal" id="viewerModal">
        <button class="viewer-backdrop" id="viewerBackdrop" aria-label="Fermer"></button>
        <div class="viewer-card">
          <img src="${n.src}" alt="Souvenir en grand format" loading="eager" />
          <p>${C(n.date)}</p>
          <button class="viewer-close" id="viewerClose">Fermer</button>
        </div>
      </section>
    `:"";l.innerHTML=`
    <main class="game-shell">
      <header class="top-bar">
        <div class="top-left">
          <button class="joker-btn" id="passBtn" title="Pass" aria-label="Pass" ${e.jokers.pass&&!e.gameOver&&e.current?"":"disabled"}>
            ‚è≠Ô∏è
            <span class="joker-count">${e.jokers.pass?"1":"0"}</span>
          </button>
          <button class="joker-btn" id="rewindInlineBtn" title="Rewind" aria-label="Rewind" ${e.jokers.rewind&&e.gameOver?"":"disabled"}>
            ‚è™
            <span class="joker-count">${e.jokers.rewind?"1":"0"}</span>
          </button>
          <button class="joker-btn" id="hintBtn" title="Indice" aria-label="Indice" ${e.jokers.hint&&!e.gameOver&&e.current?"":"disabled"}>
            üí°
            <span class="joker-count">${e.jokers.hint?"1":"0"}</span>
          </button>
        </div>
        <div class="scoreboard">
          <div class="score-pill">SCORE: <strong>${e.score}</strong></div>
        </div>
      </header>

      <section class="play-area">
        <section class="current-area">
          ${s}
          <div class="drag-hint">
            <p>Glisse la photo dans la timeline</p>
            <div class="hint-dots"><span></span><span></span><span></span></div>
          </div>
        </section>

        <section class="timeline-area">
          <div class="timeline-head">
            <h2>TIMELINE</h2>
            <p>${e.timeline.length} evenements</p>
          </div>
          <div class="timeline-track">${ie()}</div>
        </section>
      </section>

      ${o}
      ${r}
    </main>
  `,l.querySelectorAll(".insert-plus").forEach(u=>{u.addEventListener("click",()=>{const I=Number(u.dataset.insertIndex);H(I)})}),l.querySelectorAll(".timeline-photo-btn").forEach(u=>{u.addEventListener("click",()=>{const I=u.dataset.photoId;I&&oe(I)})});const d=l.querySelector("#dragImage");d&&d.addEventListener("pointerdown",u=>ae(u));const h=l.querySelector("#passBtn");h&&h.addEventListener("click",J);const M=l.querySelector("#hintBtn");M&&M.addEventListener("click",ee);const v=l.querySelector("#rewindInlineBtn");v&&v.addEventListener("click",y);const G=l.querySelector("#rewindBtn");G&&G.addEventListener("click",y);const b=l.querySelector("#replayBtn");b&&b.addEventListener("click",ne);const f=l.querySelector("#quitBtn");f&&f.addEventListener("click",te);const T=l.querySelector("#shareBtn");T&&T.addEventListener("click",()=>{se()});const j=l.querySelector("#viewerBackdrop");j&&j.addEventListener("click",S);const w=l.querySelector("#viewerClose");w&&w.addEventListener("click",S)},p=()=>{if(_(),!(g.length>=O+1)){l.innerHTML=`
      <main class="empty-screen">
        <section class="empty-card">
          <h1>Ajoute au moins 3 photos</h1>
          <p>
            Depose les images dans <code>public/photos</code>, puis lance
            <code>npm run photos:manifest</code>.
          </p>
        </section>
      </main>
    `;return}if(!e.started){ce();return}le()};p();
